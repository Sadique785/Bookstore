document.getElementById('img').addEventListener('mouseover', function(){
    imageZoom('img')
})

function imageZoom(imgID){

    let img=document.getElementById(imgID);
    let lens = document.getElementById('lens');

    console.log('Image zoom function called');
    console.log('Image source:', img.src);

    lens.style.backgroundImage= url(${img.src});
    
    let ratio = 5;
    lens.style.backgroundSize=(img.width * ratio) + 'px ' + (img.height * ratio) + 'px';
    


    img.addEventListener("mousemove", moveLens);
    lens.addEventListener("mousemove",moveLens);
    img.addEventListener("touchmove",moveLens)

    function moveLens(event){
        console.log('Mouse moved over image');

        let pos=getCursor(event)
        console.log('pos:',pos)
        
        let positionLeft = pos.x - (lens.offsetWidth/2);
        let positionTop = pos.y - (lens.offsetHeight/2);

        console.log('Lens position:', { left: positionLeft, top: positionTop });

        if (positionLeft<0){
            positionLeft=0
        }
        if(positionTop<0){
            positionTop=0
        }
        if(positionLeft> img.width - lens.offsetWidth/3){
            positionLeft = img.width - lens.offsetWidth/3
        }
        if(positionTop> img.height - lens.offsetHeight/3){
            positionTop = img.height - lens.offsetHeight/3
        }


        lens.style.left = positionLeft + 'px';
        lens.style.top = positionTop + 'px';

        lens.style.backgroundPosition= "-" + (pos.x * ratio) + 'px' + " -" + (pos.y * ratio) + 'px';

    }

    function getCursor(e){
        let bounds=img.getBoundingClientRect();
        console.log('e',e);
        console.log('bounds',bounds)
        let x=e.pageX-bounds.left;
        let y=e.pageY-bounds.top;
        x=x - window.scrollX;
        y=y-window.screenY;
        return {'x':x , 'y':y};
    }
}

















document.addEventListener('DOMContentLoaded', function () {
    var categoryDropdown = document.getElementById('category');
    var subcategoryDropdown = document.getElementById('subcategory');

    function fetchSubcategories(selectedCategoryId) {
        subcategoryDropdown.innerHTML = '<option value="">Select Subcategory</option>';

        if (selectedCategoryId) {
            fetch('/get_subcategories/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded', 
                },
                body: 'category_id=' + encodeURIComponent(selectedCategoryId),
            })
            .then(response => response.json())
            .then(data => {
                data.forEach(subcategory => {
                    var option = document.createElement('option');
                    option.value = subcategory.uid;
                    option.textContent = subcategory.subcategory_name;
                    subcategoryDropdown.appendChild(option);
                });
            })
            .catch(error => {
    console.error('Error fetching subcategories:', error);
    return error.text().then(errorMessage => {
        console.error('Server response:', errorMessage);
    });
});
        }
    }

    categoryDropdown.addEventListener('change', function () {
        var selectedCategoryId = categoryDropdown.value;
        fetchSubcategories(selectedCategoryId);
    });
});



# @csrf_exempt  # This decorator is used for simplicity, consider using a better CSRF protection strategy in production
# @require_POST
# def get_subcategories(request):
#     try:
#         data = request.POST 
#         category_id = data.get('category_id')

#         if category_id is not None:

#             cat = Category.objects.get(category_name = category_id)
#             sub = cat.category.all()

#             subcategories_list = list(sub.values()) 
#             data = {'subcategories':subcategories_list}
#             return JsonResponse(data)

#         return JsonResponse({'error': 'Category ID not provided'}, status=400)

#     except Exception as e:
#         return JsonResponse({'error': str(e)}, status=500)

# def get_subcategories(request, product_slug=None, subcategory_slug = None):
#     product = Product.objects.get(slug = product_slug)


#     if request.method == "GET":
#         category = request.GET.get('category')
#         subcategory = request.GET.get('subcategory')

#         if category and subcategory:
#             category_name = Category.objects.get(category_name = category)

#             subcategory_name = SubCategory.objects.get(subcategory_name = subcategory)

#             product.category = category_name
#             product.sub_category = subcategory_name
#             product.save()
#             messages.success(request, 'Category and Subcategory associated successfully!')
#             return redirect('admin_add_product')


#     if subcategory_slug:
#         category_option = Category.objects.get(slug = subcategory_slug)
#         print(category_option)
#         categories = Category.objects.exclude(slug = subcategory_slug)
#         subcategories = SubCategory.objects.filter(category = category_option)

#     else:
#         category_option = None
#         categories = Category.objects.all()
#         subcategories = None

    
#     context = {
#         'categories':categories,
#         'category_option':category_option,
#         'subcategories':subcategories
#         }

#     return render(request, 'admin_home/cat_subcat.html', context)